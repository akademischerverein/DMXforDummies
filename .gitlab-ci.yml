stages:
  - build
  - deploy

before_script:
  - install_choco.bat
  - choco install vswhere -y

build:
  stage: build
  before_script:
    - choco install nuget.commandline -y
  script:
    - nuget restore DMXforDummies.sln
    - msbuild /t:Clean,Rebuild DMXforDummies.sln /p:Configuration="Debug"
    - msbuild /t:Clean,Rebuild DMXforDummies.sln /p:Configuration="Release"
  tags:
    - vs2015
    - windows
  artifacts:
    when: on_success
    paths:
      - DMXforDummies\bin\Release
    expire_in: 14 days
    name: "%CI_BUILD_REF_SLUG%_%CI_BUILD_NAME%_%CI_BUILD_REF%"
  cache:
    key: "windows_$CI_PIPELINE_ID"
    paths:
      - packages
      - DMXforDummies\bin
      - DMXforDummies\obj
      
deploy-to-fs:
  stage: deploy
  tags:
    - vs2015
    - windows
  script:
    - net use \\fs\Software %AVAdmin_PW% /user:haus.akademischerverein.de\AVAdmin
    - msbuild /t:Publish DMXforDummies.sln /p:Configuration="Release" /p:DeployOnBuild=true /p:PublishDir=\\fs\Software\DMXforDummies\
  when: manual
  cache:
    key: "windows_$CI_PIPELINE_ID"
    paths:
      - packages
      - DMXforDummies\bin
      - DMXforDummies\obj